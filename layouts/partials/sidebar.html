{{ define "main-menu" }}
    {{ $currentPage := .currentPage}}
    <section class="collection">
        {{ range .menuItems }}
            {{ if not ( eq ( echoParam .Params "visibility" ) "none" ) }}
                <div class="item item__category {{ if $currentPage.HasMenuCurrent "main" . }}open{{ end }}" js-docs-menu-item>
                    <div class="item__category__name" js-category-name>{{ .Name }}</div>
                    <div class="item__category__posts {{ if .HasChildren }}item__category__posts--expandable{{end}}" js-category-posts>
                        {{ if .HasChildren }}
                            {{ template "main-menu" ( dict "menuItems" .Children "currentPage" $currentPage ) }}
                        {{ end }}
                        {{ range where site.Pages "Section" .Identifier }}
                            <a class="{{ if eq $currentPage . }}active{{ end }}" href="{{ .RelPermalink }}">{{ .Title }}</a>
                        {{ end }}
                    </div>
                </div>
            {{ end }}
        {{ end }}
    </section>
{{ end }}

<nav id="docs-menu" js-docs-menu>
    {{ template "main-menu" ( dict "menuItems" .Site.Menus.main "currentPage" . ) }}
    <section class="collection collection--external">
        <a id="codemagic-landing-link" onclick="sendGtag('Codemagic_clicked', 'DocumentationMenu')" href="https://codemagic.io/start" target="_blank">Codemagic</a>
        <a id="codemagic-blog-link" onclick="sendGtag('Blog_clicked', 'DocumentationMenu')" href="https://blog.codemagic.io" target="_blank">Blog</a>
        <a id="codemagic-youtube-link" onclick="sendGtag('YouTube_clicked', 'DocumentationMenu')" href="https://www.youtube.com/channel/UC6iPpISHwCnNreb53c0eYvg" target="_blank">YouTube Channel</a>
    </section>
</nav>


